# Лабораторная работа №6 "Решение уравнения Лапласа методом Якоби"

## Необходимо

Решить уравнение Лапласа итеративным методом Якоби.

Условия расчёта даны в файле `Laplace`.  
Дополнительно вывести время выполнения программы в терминал.

### Уравнение Лапласа в различных формах

$$ 
\frac{\partial^2 u(x,y)}{\partial x^2} + 
\frac{\partial^2 u(x,y)}{\partial y^2} = 0 \\

\partial_x^2 u(x,y) + \partial_y^2 u(x,y) = 0 \\

\Delta u(x, y) = 0 
$$

### Вывод итеративной формулы

$$ \begin{align*}
\partial_x^2 u(x,y) \approx 
\frac{u(x+h, y) - 2u(x,y) + u(x-h,y)}{h^2}  \\

\partial_y^2 u(x,y) \approx 
\frac{u(x, y+h) - 2u(x,y) + u(x,y-h)}{h^2} \\
\end{align*} $$

$$ 
0 = \Delta u(x, y) \approx 
\frac{u(x+h, y) - 2u(x,y) + u(x-h,y)}{h^2} + 
\frac{u(x, y+h) - 2u(x,y) + u(x,y-h)}{h^2}
$$

$$ 
u(x+h, y) - 2u(x,y) + u(x-h,y) + 
u(x, y+h) - 2u(x,y) + u(x,y-h) = 0
$$

$$ u(x+h, y) + u(x-h,y) + u(x, y+h) + u(x,y-h) = 4u(x,y) $$

$$ u(x,y) = \frac{u(x+h, y) + u(x-h,y) + u(x, y+h) + u(x,y-h)}{4} $$

В дискретном виде:

$$ 
U_{i,j}^{\{k+1\}} = \frac{1}{4}
(U_{i+1,j}^{\{k\}} + U_{i-1,j}^{\{k\}} + 
U_{i,j+1}^{\{k\}} + U_{i,j-1}^{\{k\}})
$$

### Граничные условия

Граничные условия получаем линейной интерполяцией по значениям в углах.

#### Первая строка:

$$
U_{1,j} = \frac{
    (M - j) \cdot U_{1, 1} + 
    (j - 1) \cdot U_{1, M}}
    {M - 1}
$$

#### Последняя строка:

$$
U_{N,j} = \frac{
    (M - j) \cdot U_{N, 1} + 
    (j - 1) \cdot U_{N, M}}
    {M - 1}
$$

#### Первый столбец:

$$
U_{i,1} = \frac{
    (N - i) \cdot U_{1, 1} + 
    (i - 1) \cdot U_{N, 1}}
    {N - 1}
$$

#### Последний столбец:

$$
U_{i,M} = \frac{
    (N - i) \cdot U_{1, M} + 
    (i - 1) \cdot U_{N, M}}
    {N - 1}
$$

### Условие остановки

Остановка итеративного процесса происходит если изменение матрицы $U$ меньше определённого значения, либо если решение не сходится и превышен предел числа итераций.

Изменение вектора берём по модулю: $| U^{\{i+1\}} - U^{\{i\}} | \leq eps$, где $|...|$ — евклидова норма:

$$ |x| = \sum_{i=1}^{N} \sum_{j=1}^{M} (U_{ij})^2 $$


## Файл с условиями

```
101
101
100 200
300 400
1e-6
```
Где:  
`101` $= N$ — число строк в матрице `U`  
`101` $= M$ — число столбцов в матрице `U`  
`100` $= U_{1, 1}$ — начальное значение в верхнем левом углу  
`200` $= U_{1, M}$ — начальное значение в верхнем правом углу  
`300` $= U_{N, 1}$ — начальное значение в нижнем левом углу  
`400` $= U_{N, M}$ — начальное значение в нижнем правом углу  
`1e-6` $= \varepsilon$ — требуемая точность

## Псевдокод
```
если (процесс == 0) {
   прочитать данные из файла
   рассчитать число строк в ленте для каждого процесса
   интерполировать граничные условия
}

разослать размеры лент и смещения
разослать точность

разослать фрагменты векторов граничных условий справа и слева

если (процесс == 0) {
   перенести верхнее гран. условия в локальную матрицу
   отправить нижнее гран. условие на последний процесс
} иначе если (процесс == последний) {
    принять нижнее гран. условие
}

рассчитать ID следующего и предыдущего процесса
с учётом переполнения и MPI_PROC_NULL

пока (ошибка > допустимой) {
    рассчитать фрагмент новой матрицы
    рассчитать локальное изменение

    отправить на следующий процесс предпоследнюю строку
    отправить на предыдущий процесс вторую строку
    ! первая и последняя строки — граничные условия
    
    разослать и рассчитать общую ошибку
}

собрать фрагменты матрицы на 0 процессе

если (процесс == 0) {  
    вывести результат в терминал
}
```

## Изучаемые элементы

`MPI_PROC_NULL` — отправка или приём с никакого процесса  
Соответствующая операция завершится успешно сразу после вызова.
